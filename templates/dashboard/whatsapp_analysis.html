I{% extends "base.html" %}

<!-- {% block title %}WhatsApp Analysis - WhatsApp UI{% endblock %} -->

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/whatsapp_analysis.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-layout">
    <!-- Include User Left Sidebar from Layout File -->
    {% include 'user_slidebar.html' %}
    
    <!-- Main Content Area -->
    <div class="main-content">
        <div class="main-header">
            <div class="header-content">
                <h1><i class="fas fa-chart-bar"></i> WhatsApp Analysis</h1>
                <p class="header-subtitle">Analyze WhatsApp group data, filter by assembly and date, and view message statistics</p>
            </div>
            <div class="header-actions">
                <button class="refresh-btn" onclick="location.reload()" title="Refresh Analysis">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        
        <div class="dashboard-content">
            <!-- Analysis Form Section -->
            <div class="section-header">
                <h3><i class="fas fa-calculator"></i> WhatsApp Analysis</h3>
                <p>Select assemblies and date range </p>
            </div>
            
            <!-- Analysis Form -->
            <div class="analysis-form">
                <div class="form-row">
                    <!-- Assembly Selection -->
                    <div class="form-group">
                        <label for="assemblyDropdown">
                            <i class="fas fa-building"></i> Select Assemblies
                        </label>
                        <div class="custom-dropdown-container">
                            <div class="custom-dropdown" id="assemblyDropdown">
                                <div class="dropdown-header" onclick="toggleDropdown()">
                                    <span class="dropdown-placeholder">Select assemblies...</span>
                                    <i class="fas fa-chevron-down dropdown-arrow"></i>
                                </div>
                                <div class="dropdown-content" id="dropdownContent">
                                    <div class="dropdown-search">
                                        <input type="text" id="assemblySearch" placeholder="Search assemblies..." onkeyup="filterAssemblies()">
                                        <i class="fas fa-search search-icon"></i>
                                    </div>
                                    <div class="dropdown-options" id="dropdownOptions">
                                        <div class="loading-spinner">
                                            <i class="fas fa-spinner fa-spin"></i> Loading assemblies...
                                        </div>
                                    </div>
                                    <div class="dropdown-actions">
                                        <button type="button" class="btn-select-all" onclick="selectAllAssemblies()">
                                            <i class="fas fa-check-double"></i> Select All
                                        </button>
                                        <button type="button" class="btn-clear-all" onclick="clearAllAssemblies()">
                                            <i class="fas fa-times"></i> Clear All
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="selected-assemblies" id="selectedAssemblies">
                                <!-- Selected assemblies will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <!-- Quick Date Filters -->
                    <div class="form-group">
                        <label>
                            <i class="fas fa-clock"></i> Quick Date Filters
                        </label>
                        <div class="quick-date-filters">
                            <label class="quick-filter-checkbox">
                                <input type="radio" name="quickFilter" value="1week" onchange="setQuickDateRange('1week')">
                                <span class="filter-label">1 Week</span>
                            </label>
                            <label class="quick-filter-checkbox">
                                <input type="radio" name="quickFilter" value="1month" onchange="setQuickDateRange('1month')">
                                <span class="filter-label">1 Month</span>
                            </label>
                            <label class="quick-filter-checkbox">
                                <input type="radio" name="quickFilter" value="3months" onchange="setQuickDateRange('3months')">
                                <span class="filter-label">3 Months</span>
                            </label>
                            <label class="quick-filter-checkbox">
                                <input type="radio" name="quickFilter" value="6months" onchange="setQuickDateRange('6months')">
                                <span class="filter-label">6 Months</span>
                            </label>
                            <label class="quick-filter-checkbox">
                                <input type="radio" name="quickFilter" value="1year" onchange="setQuickDateRange('1year')">
                                <span class="filter-label">1 Year</span>
                            </label>
                            <label class="quick-filter-checkbox">
                                <input type="radio" name="quickFilter" value="custom" onchange="setQuickDateRange('custom')" checked>
                                <span class="filter-label">Custom Range</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <!-- Date Range Selection -->
                    <div class="form-group">
                        <label for="startDate">
                            <i class="fas fa-calendar"></i> Start Date <span class="required">*</span>
                        </label>
                        <input type="date" id="startDate" name="startDate" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="endDate">
                            <i class="fas fa-calendar"></i> End Date <span class="optional">(Optional)</span>
                        </label>
                        <input type="date" id="endDate" name="endDate">
                    </div>
                </div>
                
                <!-- Sentiment Filter -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="sentiment">
                            <i class="fas fa-heart"></i> Sentiment Filter
                        </label>
                        <select id="sentiment" class="form-control">
                            <option value="all">All Sentiments</option>
                            <option value="positive">Positive</option>
                            <option value="negative">Negative</option>
                            <option value="neutral">Neutral</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-primary" onclick="analyzeJsonFiles()">
                        <i class="fas fa-calculator"></i> Apply Filter
                    </button>
                  
                 
                </div>
            </div>
            
            <!-- Group Message Statistics - Always Visible -->
            <div class="group-stats-section">
                <div class="stats-header">
                    <div class="stats-title">
                        <h4><i class="fas fa-chart-bar"></i> Group Message Statistics</h4>
                        <p class="stats-description">Message count per group based on sentiment filter</p>
                    </div>
                </div>
                
                <div class="stats-filters">
                    <div class="filter-item">
                        <span class="filter-label">Current Sentiment:</span>
                        <span class="filter-value" id="currentSentiment">All Sentiments</span>
                    </div>
                    <div class="filter-item">
                        <span class="filter-label">Total Groups:</span>
                        <span class="filter-value" id="totalGroups">0</span>
                    </div>
                    <div class="filter-item">
                        <span class="filter-label">Total Messages:</span>
                        <span class="filter-value" id="totalMessages">0</span>
                    </div>
                </div>
                
                <div class="group-stats-container">
                    <div class="stats-loading" id="statsLoading" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>Analyzing group messages...</span>
                    </div>
                    
                    <div class="group-stats-list" id="groupStatsList">
                        <div class="initial-state">
                            <i class="fas fa-info-circle"></i>
                            <p>Select assemblies and click "Apply Filter" to see group message statistics</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Analysis Results -->
            <div class="analysis-results" id="analysisResults" style="display: none;">
                <div class="section-header">
                    <h3><i class="fas fa-chart-pie"></i> Analysis Results</h3>
                </div>
                
                <div class="results-summary">
                    <div class="summary-card total-files">
                        <div class="summary-icon">
                            <i class="fas fa-file-code"></i>
                        </div>
                        <div class="summary-content">
                            <h4>Total JSON Files</h4>
                            <span class="summary-value" id="totalJsonFiles">0</span>
                        </div>
                    </div>
                    
                    <div class="summary-card selected-assemblies">
                        <div class="summary-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="summary-content">
                            <h4>Selected Assemblies</h4>
                            <span class="summary-value" id="selectedAssembliesCount">0</span>
                        </div>
                    </div>
                    
                    <div class="summary-card date-range">
                        <div class="summary-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="summary-content">
                            <h4>Date Range</h4>
                            <span class="summary-value" id="dateRange">-</span>
                        </div>
                    </div>
                </div>
                
                <!-- Assembly Breakdown -->
                <div class="assembly-breakdown-section">
                    <h4><i class="fas fa-list"></i> Assembly Breakdown</h4>
                    <div class="assembly-breakdown-list" id="assemblyBreakdownList">
                        <!-- Assembly breakdown will be populated here -->
                    </div>
                </div>
                
                <!-- Detailed Results Table -->
                <div class="detailed-results">
                    <h4><i class="fas fa-table"></i> Detailed Results</h4>
                    <div class="results-table-container">
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Assembly</th>
                                    <th>Date</th>
                                    <th>JSON Files Count</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="resultsTableBody">
                                <!-- Results will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Group Sender Analysis Results -->
            <div class="group-sender-results" id="groupSenderResults" style="display: none;">
                <div class="section-header">
                    <h3><i class="fas fa-users"></i> Group Sender Analysis</h3>
                </div>
                
                <div class="sender-summary">
                    <div class="summary-card total-groups">
                        <div class="summary-icon">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <div class="summary-content">
                            <h4>Total Groups</h4>
                            <span class="summary-value" id="totalGroupsCount">0</span>
                        </div>
                    </div>
                    
                    <div class="summary-card total-senders">
                        <div class="summary-icon">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <div class="summary-content">
                            <h4>Total Unique Senders</h4>
                            <span class="summary-value" id="totalSendersCount">0</span>
                        </div>
                    </div>
                    
                    <div class="summary-card total-messages">
                        <div class="summary-icon">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="summary-content">
                            <h4>Total Messages</h4>
                            <span class="summary-value" id="totalMessagesCount">0</span>
                        </div>
                    </div>
                </div>
                
                <!-- Group Analysis Table -->
                <div class="group-analysis-section">
                    <h4><i class="fas fa-table"></i> Group Analysis</h4>
                    <div class="group-analysis-container">
                        <table class="group-analysis-table">
                            <thead>
                                <tr>
                                    <th>Group Name</th>
                                    <th>Assembly</th>
                                    <th>Date</th>
                                    <th>Total Messages</th>
                                    <th>Unique Senders</th>
                                    <th>Top Sender</th>
                                    <th>Sentiment Breakdown</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="groupAnalysisTableBody">
                                <!-- Group analysis will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Include JavaScript -->
<script src="{{ url_for('static', filename='js/whatsapp_analysis.js') }}"></script>
{% endblock %}
